# FastAPI Application

A simple To-Do list application built with FastAPI, allowing users to create, read, update, and delete tasks.

## Requirements

* Python 3.11
* Python 3.11 devel package (python3.11-devel for Fedora-based distros, python3.11-dev Debian-based)
* Docker-compose

## Features

- User authentication (login and registration)
- Create, read, update, and delete tasks
- Assign tasks to users
- Set task completion status
- Role-based access control (admin and user roles)

## Setup

### Step 1: Create and activate the Virtual Environment

To create and enter the virtual environment, run:
```bash
python3 -m venv .venv
source  .venv/bin/activate
```

### Step 2: Install the dependencies
Install the dependencies from the `requirements.txt` file:

```bash
pip  install  -r  requirements.txt
```

### Step 3: Configure ENV variables

Create a file ".env" with the following variables:

```bash
db_host=HOST
db_database=DATABASE
db_user=DB_USER
db_password=USER_PASSWORD

test_db_database=TEST_DATABASE
test_db_user=TEST_DB_USER
test_db_password=TEST_USER_PASSWORD

admin_username=ADMIN_USERNAME (Optional)
admin_email=ADMIN_USER_EMAIL (Optional)
admin_password=ADMIN_USER_PASSWORD (Optional)  
secret_key = "random string"
```
A test database will be created as well. If admin username, email and password are not provided, default values will be used. The secret key can be generated by running: 
```bash
openssl rand -hex 32  
```

### Step 4: Start the PostgreSQL container

Start the docker container and wait for the migration to conclude:

```bash
docker-compose  up  -d
```

### Step 5: Apply Database Migrations (Alembic)

Run the migration command:

```bash
alembic  upgrade  head
```

### Step 6: Run the Application

Run the FastAPI application using Uvicorn:

```bash
uvicorn  app:app  --reload
```


### Endpoints

#### Miscellaneous Routes

| Method | Endpoint              | Description           | Authentication Required |
|--------|-----------------------|-----------------------|-------------------------|
| `GET`  | `/api/v1/`            | Root Test             | No                      |
| `GET`  | `/api/v1/test`        | Test Route            | No                      |
| `GET`  | `/api/v1/db-connection` | Testing Connection  | No                      |
| `GET`  | `/api/v1/schema`      | Get Schema Version    | No                      |

#### Tasks

| Method  | Endpoint                   | Description        | Authentication Required |
|---------|----------------------------|--------------------|-------------------------|
| `GET`   | `/api/v1/tasks/`           | Get All Todos      | Yes                     |
| `POST`  | `/api/v1/tasks/`           | Add Todo           | Yes                     |
| `GET`   | `/api/v1/tasks/{task_id}`  | Get Task by Id     | Yes                     |
| `PUT`   | `/api/v1/tasks/{task_id}`  | Update Todo        | Yes                     |
| `DELETE`| `/api/v1/tasks/{task_id}`  | Delete Todo        | Yes (Owner or Admin)    |
| `PUT`   | `/api/v1/tasks/{task_id}/finish` | Mark Completed | Yes                   |

#### Users

| Method  | Endpoint                   | Description        | Authentication Required |
|---------|----------------------------|--------------------|-------------------------|
| `POST`  | `/api/v1/users/register`   | Create User        | No                      |
| `GET`   | `/api/v1/users/{id_}`      | Get User           | Yes                     |
| `PUT`   | `/api/v1/users/{id_}`      | Update User        | Yes (Owner or Admin)    |
| `DELETE`| `/api/v1/users/{id_}`      | Delete User        | Yes (Owner or Admin)    |
| `PATCH` | `/api/v1/users/{id_}`      | Set Role           | Yes (Admin only)        |
| `GET`   | `/api/v1/users/`           | Get All Users      | Yes (Admin only)        |

#### Authentication

| Method  | Endpoint                   | Description        | Authentication Required |
|---------|----------------------------|--------------------|-------------------------|
| `POST`  | `/api/v1/login`            | Login              | No                      |

## Authentication

To access endpoints that require authentication, you need to include a valid JWT token in the `Authorization` header as a Bearer token. The "login" endpoint generates a new token with a default expiration of 7 days. 

Example updating the email of user with ID 2 using curl:
```bash
curl -i localhost:8000/api/v1/users/2 -XPUT -H 'Content-Type: application/json' -d '{"email":"newemail@test.com"}' -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." -w '\n'
```

## Contributions

Unit tests were added to the project. Also, linter checks might be performed by following the instructions provided below.

### Running Tests

We use `pytest` for running tests. To run the tests, follow these steps:

1.  **Install dependencies**:

Make sure you have all the necessary dependencies installed.
```bash
pip install -r requirements-dev.txt
```

2.  **Run the tests**:
To run all the tests, run:
```bash
pytest -v
```

### Running Linter Checks

To run linter checks, follow these steps:

1.  **Install dependencies**:

If not done in the previous step, install the dependencies using the requirements-dev.txt file:
```bash
pip install -r requirements-dev.txt
```

2.  **Run `pylint`**:

```bash
pylint *.py **/*.py
```
